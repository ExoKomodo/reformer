image: alpine/latest
sources:
  - git@git.sr.ht:~jamesaorson/reformer
environment:
  TARGET: git@github.com:exokomodo/reformer
# https://builds.sr.ht/secrets
secrets:
  # NOTE: github-ssh-key:
  - 6d1be687-6726-4733-a69a-a6d75fe21d85
tasks:
  - ssh-config: |-
      touch ~/.ssh/config
      cat <<EOF >> ~/.ssh/config
      Host github.com
        User git
        IdentityFile ~/.ssh/6d1be687-6726-4733-a69a-a6d75fe21d85
      EOF
  - add-remote: |-
      cd reformer
      git remote add target ${TARGET}
  - mirror: |-
      cd reformer
      git push --force target --tags "refs/remotes/origin/*:refs/heads/*"
